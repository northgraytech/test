<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>⚫ NGT Stealth Transcriber</title>
<style>
/* --- NGT Dark Mode Styling --- */
body { 
    font-family: 'Consolas', 'Courier New', monospace; /* Techy Monospace Font */
    background-color: #121212; /* Very Dark Background */
    margin:0; 
    padding:0; 
    text-align:center; 
    color:#e0e0e0; /* Light Gray Text */
}
header { 
    background-color:#000; 
    color:#fff; 
    padding:30px; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.5); 
    border-bottom: 3px solid #e63946; /* NGT Red Accent */
}
header h1 { 
    margin:0; 
    color:#4fc3f7; /* Tech Blue Accent */
    font-size: 2.5em; 
    letter-spacing: 2px;
}
section { 
    padding:30px 20px; 
}
.controls { 
    margin: 30px auto; 
    max-width: 700px; 
    display: flex; 
    justify-content: space-around; 
}

/* --- Button Styling (Futuristic/Sleek) --- */
button { 
    padding:12px 28px; 
    font-size:16px; 
    border: 2px solid;
    border-radius:6px; 
    cursor:pointer; 
    transition: background-color 0.3s, border-color 0.3s, transform 0.1s, box-shadow 0.3s; 
    font-weight: bold; 
    min-width: 180px; 
    letter-spacing: 1px;
    text-transform: uppercase;
}
button:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 0 15px rgba(79, 195, 247, 0.4); /* Blue Glow */
}
button:disabled { 
    opacity: 0.4; 
    cursor: not-allowed; 
    transform: none; 
    box-shadow: none; 
}

#startBtn { 
    background-color:#e63946; /* NGT Red */
    color:#fff; 
    border-color: #e63946;
}
#startBtn:hover:not(:disabled) { 
    background-color: #c0392b; 
    border-color: #c0392b;
}
#stopBtn { 
    background-color:#2c3e50; /* Darker Blue-Gray */
    color:#fff; 
    border-color: #4fc3f7; /* Tech Blue Border */
}
#stopBtn:hover:not(:disabled) { 
    background-color: #34495e;
}
#downloadBtn { 
    background-color: #1a1a1a; 
    color:#4fc3f7; /* Tech Blue Text */
    border-color: #4fc3f7;
}
#downloadBtn:hover:not(:disabled) { 
    background-color: #4fc3f7; 
    color: #000; 
}

/* --- Status & Transcript Styling --- */
#status { 
    margin-top: 20px; 
    font-size: 1.1em; 
    color: #4fc3f7; 
    min-height: 20px; 
    text-shadow: 0 0 5px rgba(79, 195, 247, 0.5); /* Subtle Glow */
}
#transcript { 
    width:90%; 
    max-width:900px;
    margin:25px auto; 
    padding:20px; 
    border:2px solid #333; 
    min-height:350px; 
    overflow-y:auto; 
    background-color:#1c1c1c; /* Dark Inner Background */
    color:#00ff00; /* Classic Green Terminal Text */
    text-align: left; 
    line-height: 1.5; 
    border-radius: 4px; 
    box-shadow: inset 0 0 10px rgba(0,255,0,0.1);
    white-space: pre-wrap;
    font-size: 1.05em;
}
</style>
</head>
<body>
<header>
  <h1>NGT | STEALTH TRANSCRIBER</h1>
</header>
<section>
  <p>INITIATE live audio capture and transcription for meeting data logging. Click <span style="color:#e63946; font-weight:bold;">START</span> to begin data feed.</p>
  <div class="controls">
    <button id="startBtn">START RECORDING</button>
    <button id="stopBtn" disabled>STOP DATA FEED</button>
    <button id="downloadBtn" disabled>DOWNLOAD LOG</button>
  </div>
  <div id="status">STATUS: System Online.</div>
  <div id="transcript"></div>
</section>

<script>
let recognition = null;
let listening = false;
let transcriptText = ''; // Stores the final, confirmed transcript
const transcriptDiv = document.getElementById('transcript');
const statusDiv = document.getElementById('status');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const downloadBtn = document.getElementById('downloadBtn');

// --- Helper Functions ---

function updateStatus(message, color = '#4fc3f7') {
  statusDiv.innerText = 'STATUS: ' + message;
  statusDiv.style.color = color;
  statusDiv.style.textShadow = color !== '#e63946' ? `0 0 5px ${color}` : 'none';
}

function updateButtons(isListening) {
  startBtn.disabled = isListening;
  stopBtn.disabled = !isListening;
  downloadBtn.disabled = isListening || transcriptText.trim().length === 0;
}

// --- Speech Recognition Core ---

function initializeRecognition() {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  if (!SpeechRecognition) {
    updateStatus('ERROR: Web Speech API not detected. Try Chrome or Edge.', '#e63946');
    return null;
  }
  
  const recog = new SpeechRecognition();
  recog.continuous = true; 
  recog.interimResults = true; 
  recog.lang = 'en-US'; 

  recog.onresult = (event) => {
    let interim = '';
    let final = '';

    for (let i = event.resultIndex; i < event.results.length; ++i) {
      const result = event.results[i];
      if (result.isFinal) {
        // Add speaker identifier or just capitalize the start of a sentence
        let sentence = result[0].transcript;
        sentence = sentence.charAt(0).toUpperCase() + sentence.slice(1);
        final += `> ${sentence}. \n`; 
      } else {
        interim += result[0].transcript;
      }
    }

    transcriptText += final;
    
    // Display both final and live interim text in the div
    transcriptDiv.innerText = transcriptText + (interim ? ` [LIVE FEED: ${interim}... ]` : '');
    
    // Auto-scroll to the bottom 
    transcriptDiv.scrollTop = transcriptDiv.scrollHeight;
  };

  recog.onend = () => {
    if (listening) {
      updateStatus('RESTARTING: Service Timeout Detected...', '#e63946');
      try {
        recog.start();
      } catch (e) {
        console.error('Error restarting recognition:', e);
      }
    }
  };
  
  recog.onerror = (event) => {
    updateStatus(`CRITICAL ERROR: ${event.error}`, '#e63946');
    console.error('Speech recognition error:', event.error);
    if (listening) {
      recognition.stop();
      listening = false;
      updateButtons(false);
      updateStatus('SYSTEM HALTED: Review Log.', '#e63946');
    }
  };

  return recog;
}

// --- Event Listeners ---

startBtn.addEventListener('click', () => {
  if (listening) return;

  if (transcriptText.trim().length > 0) {
    transcriptText = '';
    transcriptDiv.innerText = '';
  }
  
  recognition = initializeRecognition();
  
  if (recognition) {
    try {
      recognition.start();
      listening = true;
      updateButtons(true);
      updateStatus('ACTIVE: Data Feed Initiated.', '#00ff00'); /* Bright Green for Active */
    } catch (e) {
      updateStatus('WARNING: Already Active.', '#00ff00'); 
      listening = true;
      updateButtons(true);
    }
  }
});

stopBtn.addEventListener('click', () => {
  if (!listening) return;
  
  recognition.stop();
  listening = false;
  updateButtons(false);
  updateStatus('PAUSED: Finalizing Transcript Log.', '#4fc3f7');
  
  transcriptDiv.innerText = transcriptText;
});

downloadBtn.addEventListener('click', () => {
  if (transcriptText.trim().length === 0) {
    updateStatus('ERROR: Log is empty. Nothing to download.', '#e63946');
    return;
  }
  
  const blob = new Blob([transcriptText], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = new Date().toISOString().slice(0, 19).replace(/[:T-]/g, ''); // Format YYYYMMDDHHMMSS
  
  a.href = url;
  a.download = `NGT_LOG_${date}.txt`;
  
  document.body.appendChild(a);
  a.click();
  
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  
  updateStatus('SUCCESS: Log downloaded.', '#00ff00');
});

// Initial state setup
document.addEventListener('DOMContentLoaded', () => {
  updateButtons(false);
});
</script>
</body>
</html>
